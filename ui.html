<link rel="stylesheet" href="https://static.figma.com/api/figma-extension-api-0.0.1.css">
<style>
  body {
    background-color: #1C2039;
    color: #F6F7F9;
    margin: 37;
  }

  button {
    float: left;
    font-size: 20px;
    color: #F6F7F9;
    background-color: #383C59;
    width: 280px;
    height: 80px;
    margin-top: 15px;
    margin-right: 15px;
    border: none;
    border-radius: 10px;
    max-width: 300px;
  }

  #BarButton, #TimeButton{
    margin-right: 0;
  }

</style>
<img src="./Logo.svg" alt="x">
<p>
    Wartości: <input id="textbox" placeholder="1, 2, 3, ..." value="1, 2, 3, 4">
</p>
<b id="errors"></b>
<button id='PieButton'>Wykres kołowy</button>
<button id='BarButton'>Wykres słupkowy</button>
<button id='CircleButton'>Wykres kołowy procentowy</button>
<button id='TimeButton'>Wykres natężenia czasu</button>

<script>
  document.getElementById('PieButton').onclick = () => {
    const text = document.querySelector('#textbox').value;

    let numbers = text.split(',').map(x => +x)
    if (numbers.length < 2) {
      showError('Error: Musi mieć minimum 2 wartości');
      return
    }
    if (numbers.some(x => isNaN(x))) {
      showError('Error: Wszystkie wartości muszą być liczbami');
      return
    }

    parent.postMessage({ pluginMessage: { type: 'pie', numbers } }, '*')
  }

  document.getElementById('BarButton').onclick = () => {
    const text = document.querySelector('#textbox').value;
    let numbers = text.split(',').map(x => +x)

    if (numbers.length < 2) {
      showError('Error: Musi mieć minimum 2 wartości');
      return
    }
    if (numbers.some(x => isNaN(x))) {
      showError('Error: Wszystkie wartości muszą być liczbami');
      return
    }

    parent.postMessage({ pluginMessage: { type: 'bar', numbers } }, '*')
  }

  document.getElementById('CircleButton').onclick = () => {
    const text = document.querySelector('#textbox').value;
    let numbers = text.split(',').map(x => +x)

    if (numbers.length < 1) {
      showError('Error: Musi mieć minimum 1 wartość');
      return
    }

    if (numbers.length > 4) {
      showError('Error: Może mieć maximum 4 wartości');
      return
    }
    let numbers2 = (numbers).map(x => Math.max(0, x));
    const total = numbers2.reduce((a, b) => a + b, 0);

    if (total > 100) {
      showError('Error: Suma wartości % musi być mniejsza niż 100');
      return
    }

    if (numbers.some(x => isNaN(x))) {
      showError('Error: Wszystkie wartości muszą być liczbami');
      return
    }

    parent.postMessage({ pluginMessage: { type: 'circle', numbers } }, '*')
  }

  document.getElementById('TimeButton').onclick = () => {
    const text = document.querySelector('#textbox').value;
    let numbers = text.split(',').map(x => +x)

    if (numbers.length != 2) {
      showError('Error: Musi mieć 2 wartości');
      return
    }

    if (numbers.some(x => isNaN(x))) {
      showError('Error: Wszystkie wartości muszą być liczbami');
      return
    }

    parent.postMessage({ pluginMessage: { type: 'time', numbers } }, '*')
  }


  showError = errorMessage => {
    document.querySelector('#errors').textContent = errorMessage
  }
  
</script>